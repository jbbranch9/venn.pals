<!DOCTYPE html>

<html lang="en">

<link rel="stylesheet" type="text/css" href="CSS/main.css">

<head>

    <title>Movie Search</title>

<!-- import jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body>

<!-- search bar -->
    <input type="text" placeholder="Title (Required)" id="titleInput">
    <input type="text" placeholder="Year" id="yearInput">
    <button type="button" onclick="getInputValue();">Search</button>
    
    <script>
        function getInputValue(){
            // select the input elements and get their values 
            var inputVal = document.getElementById("titleInput").value;
            var year = document.getElementById("yearInput").value;

            /* trim leading whitespace */
            while (inputVal[0]==" ") {
                inputVal = inputVal.slice(1);
                if(inputVal[0]!=" ") {
                    break
                }
            }


            // format the input
            var formattedInput = "";

            var i;
            for (i=0; i<inputVal.length; i++) {
                if (inputVal[i]==" ") {
                    if (i == 0 || i == inputVal.length) {
                        continue
                    } else {
                        formattedInput+="+";
                    }
                    
                } else {
                    formattedInput+=inputVal[i];
                }

            }

            /* construct URL */

            var yearSearchTerm = "";
            if (year!=null){
                yearSearchTerm = "&y="+year;
            }

            omdbURL = "http://www.omdbapi.com/?t="+formattedInput+yearSearchTerm+"&r=json&plot=full&apikey=cb9a68ca";

            getMovieData(omdbURL);
        }
    </script>


<!-- panel contains frames for poster and text -->
    <div class="panel" id="001">
        
        <div class="picFrame" id="001">
            Poster
        </div>
<!-- need better solution than just <br> -->
        <br><br><br><br><br><br><br><br><br><br><br><br>
        <div class="textFrame" id="001">
            Text
        </div>

    </div>

<!-- requests JSON and poster image from OMDB -->
    <script>
        function getMovieData(omdbURL) {

            $.getJSON(omdbURL, function(data) {
                
                var text = `
                            Title: ${data.Title}<br><br>
                            Year: ${data.Year}<br><br>
                            Actors: ${data.Actors}<br><br>
                            Plot: ${data.Plot}<br><br>
                            Director: ${data.Director}<br><br>
                            Writer: ${data.Writer}<br><br>
                            Rated: ${data.Rated} | Runtime: ${data.Runtime} | Genre: ${data.Genre}
                            `        
                
                $(".textFrame").html(text);
                
                var poster = "<img src=\""+data.Poster+"\" alt=\""+data.Title+" poster\">"
                $(".picFrame").html(poster);

            });
        }



    </script>


</body>
</html>